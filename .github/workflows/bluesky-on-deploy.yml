# DISABLED: This workflow was causing duplicate posts
# The bluesky-auto-post.yml workflow already handles posting on push and schedule
# To re-enable, replace the 'never' trigger with the workflow_run trigger below
name: Post to Bluesky on Deploy

on:
  # This trigger will never fire, effectively disabling the workflow
  workflow_dispatch:
    inputs:
      reason:
        description: 'This workflow is disabled to prevent duplicate posts'
        required: true
        default: 'disabled'
  
  # To re-enable, uncomment this and remove the workflow_dispatch above:
  # workflow_run:
  #   workflows: ["ci"]
  #   types:
  #     - completed

jobs:
  post-to-bluesky:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    # Only run if the triggering workflow had changes to blog posts
    # This prevents duplicate posts when bluesky-auto-post.yml already ran
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5

      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: '3.13'

      - name: Install dependencies
        run: |
          pip install atproto requests python-dateutil pyyaml

      - name: Post new blog posts to Bluesky
        env:
          BLUESKY_IDENTIFIER: ${{ secrets.BLUESKY_IDENTIFIER }}
          BLUESKY_PASSWORD: ${{ secrets.BLUESKY_PASSWORD }}
        run: |
          python .github/scripts/bluesky_auto_post.py
